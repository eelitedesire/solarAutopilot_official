<!DOCTYPE html>
<html>
  <head> 
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Solar Autopilot </title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="all,follow">
    <!-- Bootstrap CSS-->
    <link rel="stylesheet" href="vendor/bootstrap/css/bootstrap.min.css">
    <!-- Font Awesome CSS-->
    <link rel="stylesheet" href="vendor/font-awesome/css/font-awesome.min.css">
    <!-- Custom Font Icons CSS-->
    <link rel="stylesheet" href="css/font.css">
    <!-- Google fonts - Muli-->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Muli:300,400,700">
    <!-- theme stylesheet-->
    <link rel="stylesheet" href="css/style.default.css" id="theme-stylesheet">
    <!-- Custom stylesheet - for your changes-->
    <link rel="stylesheet" href="css/custom.css">
    <!-- Favicon-->
    <link rel="shortcut icon" href="https://carbonoz.com/assets/images/image04.jpg?v=8b5d1d9b">
    <!-- Tweaks for older IEs--><!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script><![endif]-->
  </head>
  <body>
    <header class="header">   
      <nav class="navbar navbar-expand-lg">
        <div class="search-panel">
          <div class="search-inner d-flex align-items-center justify-content-center">
            <div class="close-btn">Close <i class="fa fa-close"></i></div>
            <form id="searchForm" action="#">
              <div class="form-group">
                <input type="search" name="search" placeholder="What are you searching for...">
                <button type="submit" class="submit">Search</button>
              </div>
            </form>
          </div>
        </div>
        <div class="container-fluid d-flex align-items-center justify-content-between">
          <div class="navbar-header">
            <!-- Navbar Header--><a href="<%= ingress_path %>/" class="navbar-brand">
              <div class="brand-text brand-big visible text-uppercase"><img src="https://carbonoz.com/assets/images/image04.jpg?v=8b5d1d9b" alt="" width="40px"style="margin-right: 10px;"><strong class="text-primary">Solar</strong><strong>Autopilot</strong></div>
              <div class="brand-text brand-sm"><img src="https://carbonoz.com/assets/images/image04.jpg?v=8b5d1d9b" alt="" width="40px"style="margin-right: 10px;"><strong class="text-primary">S</strong><strong>A</strong></div></a>
            <!-- Sidebar Toggle Btn-->
            <button class="sidebar-toggle"><i class="fa fa-long-arrow-left"></i></button>
          </div>
         
        </div>
      </nav>
    </header>
    <div class="d-flex align-items-stretch">
      <!-- Sidebar Navigation-->
      <nav id="sidebar">
        <!-- Sidebar Header-->
        <div class="sidebar-header d-flex align-items-center">

          
        </div>
        <!-- Sidebar Navidation Menus--><span class="heading">Main</span>
        <ul class="list-unstyled">
          <li class="active"><a href="<%= ingress_path %>/"><i class="fa fa-home"></i> Home</a></li>

          <li><a href="<%= ingress_path %>/dashboard"><i class="fa fa-bolt"></i> Energy</a></li>
          <li><a href="<%= ingress_path %>/analytics"><i class="fa fa-calculator"></i> Totals</a></li>

       
              <li><a href="<%= ingress_path %>/messages"><i class="fa fa-envelope"></i> Messages</a></li>

              <li><a href="<%= ingress_path %>/settings"><i class="fa fa-cog"></i> Settings</a></li>
             


      </ul>
      </nav>
      <!-- Sidebar Navigation end-->
      <div class="page-content">
        <div class="page-header">
          <div class="container-fluid">
            <h2 class="h5 no-margin-bottom">Dashboard</h2>
          </div>
        </div>
    
        
       
    
       
        <section>
          <div class="grid-container">
            <!-- Solar Production Card -->
            <div class="card">
              <div class="card-content" style="--clr:#06ccff;--num:78">
                <div class="circle-progress solar-production">
                  <svg>
                    <circle class="background" cx="70" cy="70" r="70"></circle>
                    <circle class="progress" cx="70" cy="70" r="70"></circle>
                  </svg>
                  <i class="fas fa-solar-panel icon" style="color: #06ccff;">Solar</i>
                  <div class="number">
                    <div class="value">0.0 W </div>
                  </div>
                </div>
                <home-assistant-energy-usage-card
                  period="daily"
                  detail-period="monthly"
                  data="<%= JSON.stringify(data.solarProductionData) %>">
                </home-assistant-energy-usage-card>
              </div>
            </div>
            <!-- Battery State of Charge Card -->
            <div class="card">
              <div class="card-content" style="--clr:#ff00be;--num:78">
                <div class="circle-progress battery-state-of-charge">
                  <svg>
                    <circle class="background" cx="70" cy="70" r="70"></circle>
                    <circle class="progress" cx="70" cy="70" r="70"></circle>
                  </svg>
                  <i class="fas fa-battery-full icon" style="color: #ff00be;">Battery</i>
                  <div class="number">
                    <div class="value">0.0 %</div>
                  </div>
                </div>
                <home-assistant-battery-storage-card
                  data="<%= JSON.stringify(data.batteryStateOfChargeData) %>">
                </home-assistant-battery-storage-card>
              </div>
            </div>
            <!-- Grid Import Card -->
            <div class="card">
              <div class="card-content" style="--clr:#fee800;;--num:78">
                <div class="circle-progress grid-import">
                  <svg>
                    <circle class="background" cx="70" cy="70" r="70"></circle>
                    <circle class="progress" cx="70" cy="70" r="70"></circle>
                  </svg>
                  <i class="fas fa-bolt icon" style="color: #fee800;;">Grid
                </i>
                  <div class="number">
                    <div class="value">0.0 W</div>
                  </div>
                </div>
                <home-assistant-energy-usage-card
                  period="daily"
                  detail-period="monthly"
                  data="<%= JSON.stringify(data.gridPowerData) %>">
                </home-assistant-energy-usage-card>
              </div>
            </div>
            <!-- Load Power Card -->
            <div class="card">
              <div class="card-content" style="--clr: #00ffae;--num:78">
                <div class="circle-progress load-power">
                  <svg>
                    <circle class="background" cx="70" cy="70" r="70"></circle>
                    <circle class="progress" cx="70" cy="70" r="70"></circle>
                  </svg>
                  <i class="fas fa-bolt icon" style="color: #00ffae;">Load</i>
                  <div class="number">
                    <div class="value">0.0 W</div>
                  </div>
                </div>
                <home-assistant-energy-usage-card
                  period="daily"
                  detail-period="monthly"
                  data="<%= JSON.stringify(data.loadPowerData) %>">
                </home-assistant-energy-usage-card>
              </div>
            </div>
      
            <!-- Grid Voltage Card -->
      <div class="card">
        <div class="card-content" style="--clr:#ffa500;--num:78">
          <div class="circle-progress grid-voltage">
            <svg>
              <circle class="background" cx="70" cy="70" r="70"></circle>
              <circle class="progress" cx="70" cy="70" r="70"></circle>
            </svg>
            <i class="fas fa-bolt icon" style="color: #ffa500;">Grid V</i>
            <div class="number">
              <div class="value">0.0 V</div>
            </div>
          </div>
        </div>
      </div>
        </section>
        <footer class="footer">
          <div class="footer__block block no-margin-bottom">
            <div class="container-fluid text-center">
              <!-- Please do not remove the backlink to us unless you support us at https://bootstrapious.com/donate. It is part of the license conditions. Thank you for understanding :)-->
               <p class="no-margin-bottom">2024 &copy; Carbonoz</p>
            </div>
          </div>
        </footer>
      </div>
    </div>
    <!-- JavaScript files-->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/popper.js/umd/popper.min.js"> </script>
    <script src="vendor/bootstrap/js/bootstrap.min.js"></script>
    <script src="vendor/jquery.cookie/jquery.cookie.js"> </script>
    <script src="vendor/chart.js/Chart.min.js"></script>
    <script src="vendor/jquery-validation/jquery.validate.min.js"></script>
    <script src="js/charts-home.js"></script>
    <script src="js/front.js"></script>

    <script>
      function updateRealTimeData() {
        fetch('<%= ingress_path %>/api/realtime-data')
            .then(response => response.json())
            .then(data => {
                console.log('Fetched Data:', data);

                updateCircleProgress('.solar-production', data.solarProduction, '#06ccff');
                updateCircleProgress('.battery-state-of-charge', data.batteryStateOfCharge, '#ff00be');
                updateCircleProgress('.grid-import', data.gridImport, '#fee800');
                updateCircleProgress('.load-power', data.loadPower, '#00ffae');
                updateCircleProgress('.grid-voltage', data.gridVoltage, '#ffa500');

                // Update charts with fetched data
                updateChartsWithData(data);
            })
            .catch(error => {
                console.error('Error fetching real-time data:', error);
            });
    }

    function updateCircleProgress(selector, data, color) {
        const progressElement = document.querySelector(`${selector} .progress`);
        const valueElement = document.querySelector(`${selector} .value`);
        const iconElement = document.querySelector(`${selector} .icon`);

        const maxValue = selector === '.grid-voltage' ? 500 : 1000; // Maximum value for grid voltage and other metrics
        const progress = (data.value / maxValue) * 100;

        progressElement.style.strokeDashoffset = 565.48 - (565.48 * progress / 100);
        progressElement.style.stroke = color;
        iconElement.style.color = color;
        valueElement.textContent = `${data.value.toFixed(2)} ${selector === '.grid-voltage' ? 'V' : 'W'}`;
    }


      // Update real-time data every 5 seconds
      setInterval(updateRealTimeData, 5000);
    </script>
  </body>
</html>